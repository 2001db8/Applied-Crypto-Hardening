%%\subsection{Recommended cipher suites}
\label{section:recommendedciphers}

In principle, system administrators who want to improve their servers need to
make a hard decision between locking out some users while keeping very high
cipher suite security levels or supporting as many users as possible while
lowering some settings. \url{https://www.ssllabs.com/} gives administrators a
tool to test out different settings. The authors of this guide used ssllabs.com
to arrive at a set of cipher suites which we will recommend throughout this
document.  \textbf{Caution: these settings can only represent a subjective
choice of the authors at the time of this writing. It might be a wise choice to
select your own cipher suites based on the instructions in section
\ref{section:ChoosingYourOwnCipherSuites}}.


\subsubsection{Configuration A: strong ciphers, fewer clients}

At the time of this writing, we recommend the following set of strong cipher
suites which may be useful in an environment where you do not depend on many,
diverse external clients and where compatibility is not an issue.  An example
of such an environment might be machine 2 machine communications or corporate
environments where you can define the software which must be used.


We arrived at this set of cipher suites by selecting

\begin{itemize}
\item TLS 1.2
\item Perfect forward secrecy / ephemeral Diffie Hellman
\item strong Hashes (SHA-2)
\item GCM as Authenticated Encryption scheme where possible
\end{itemize}

This results in the string:

\begin{lstlisting}[breaklines]
'EECDH+aRSA+AES256:EDH+aRSA+AES256:!SSLv3'
\end{lstlisting}

%$\implies$ resolves to 
%
%\begin{verbatim}
%openssl ciphers -V $string
%\end{verbatim}



\todo{make a column for cipher chaining mode}
\begin{center}

\begin{tabular}{lllllll}
\toprule
\textbf{ID}   & \textbf{OpenSSL Name}       & \textbf{Version} & \textbf{KeyEx} & \textbf{Auth} & \textbf{Cipher} & \textbf{MAC}\\\cmidrule(lr){1-7}
\verb|0xC030| & ECDHE-RSA-AES256-GCM-SHA384 & TLSv1.2          & ECDH           &  RSA          & AESGCM(256)     & AEAD         \\
\verb|0xC028| & ECDHE-RSA-AES256-SHA384     & TLSv1.2          & ECDH           &  RSA          & AES(256) (CBC)  & SHA384       \\
\verb|0x009F| & DHE-RSA-AES256-GCM-SHA384   & TLSv1.2          & DH             &  RSA          & AESGCM(256)     & AEAD         \\
\verb|0x006B| & DHE-RSA-AES256-SHA256       & TLSv1.2          & DH             &  RSA          & AES(256) (CBC)  & SHA256       \\
\bottomrule
\end{tabular}
\end{center}


\textbf{Compatibility}

Only clients which support TLS 1.2 are covered by these cipher suites (Chrome 30,
Win 7 and Win 8.1 crypto stack, Opera 17, OpenSSL $\ge$ 1.0.1e, Safari 6 / iOS
6.0.1, Safari 7 / OS X 10.9).



\subsubsection{Configuration B: weaker ciphers, many clients}

In this section we propose a slightly "weaker" set of cipher suites. For example, there are
some known weaknesses for SHA-1 which is included in this set.
However, the advantage of this set of cipher suites is its wider compatibility
with clients. 


\textbf{In the following document, all further examples in this paper will use Configuration B}.


We arrived at this set of cipher suites by selecting

\begin{itemize}
\item TLS 1.2, TLS 1.1, TLS 1.0
\item allowing SHA-1
\todo{AK: Note that SHA1 is considered broken but if we are in DHE, we might get around it as long as you can not calculate a SHA1 collision ``live'' on the wire}

\end{itemize}

This results in the string:

\begin{lstlisting}[breaklines]
old (pre 20131202): 'EECDH+aRSA+AESGCM:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EDH+CAMELLIA256:EECDH:EDH+aRSA:+SSLv3:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS:!RC4:!SEED:!AES128:!CAMELLIA128:!ECDSA:AES256-SHA'

newest 20131202:
'EDH+CAMELLIA:EDH+aRSA:EECDH+aRSA+AESGCM:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH:+CAMELLIA256:+AES256:+CAMELLIA128:+AES128:+SSLv3:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!SRP:!DSS:!RC4:!SEED:!ECDSA:CAMELLIA256-SHA:AES256-SHA:CAMELLIA128-SHA:AES128-SHA'

\end{lstlisting}

\todo{adapt this table to the "newest" cipher string} \\
\todo{make a column for cipher chaining mode}
\begin{center}
\begin{tabular}{lllllll}
\toprule
\textbf{ID}   & \textbf{OpenSSL Name}       & \textbf{Version} & \textbf{KeyEx} & \textbf{Auth} & \textbf{Cipher} & \textbf{MAC}\\\cmidrule(lr){1-7}
\verb|0xC030| & ECDHE-RSA-AES256-GCM-SHA384 & TLSv1.2          & ECDH           &  RSA          & AESGCM(256)     & AEAD         \\ 
\verb|0xC028| & ECDHE-RSA-AES256-SHA384     & TLSv1.2          & ECDH           &  RSA          & AES(256) (CBC)  & SHA384       \\ 
\verb|0x009F| & DHE-RSA-AES256-GCM-SHA384   & TLSv1.2          & DH             &  RSA          & AESGCM(256)     & AEAD         \\ 
\verb|0x006B| & DHE-RSA-AES256-SHA256       & TLSv1.2          & DH             &  RSA          & AES(256) (CBC)  & SHA256       \\ 
\verb|0x0088| & DHE-RSA-CAMELLIA256-SHA     & SSLv3            & DH             &  RSA          & Camellia(256)   & SHA1         \\ 
\verb|0xC014| & ECDHE-RSA-AES256-SHA        & SSLv3            & ECDH           &  RSA          & AES(256) (CBC)  & SHA1         \\ 
\verb|0x0039| & DHE-RSA-AES256-SHA          & SSLv3            & DH             &  RSA          & AES(256) (CBC)  & SHA1         \\ 
\verb|0x0035| & AES256-SHA                  & SSLv3            & RSA            &  RSA          & AES(256) (CBC)  & SHA1         \\
\bottomrule
\end{tabular}
\end{center}

\textbf{Compatibility}

Note that these cipher suites will not work with anything using Windows XP's
crypto stack (IE, Outlook), Java 6, Java 7 and Android 2.3. Java 7 could be
made compatible by installing the "Java Cryptography Extension (JCE) Unlimited
Strength Jurisdiction Policy Files"
(JCE) \footnote{\url{http://www.oracle.com/technetwork/java/javase/downloads/jce-7-download-432124.html}}.
We could not verify yet if installing JCE also fixes the Java 7
DH-parameter length limitation (1024 bit). 

\textbf{Explanation}

For a detailed explanation of the cipher suites chosen, please see
\ref{section:ChoosingYourOwnCipherSuites}. In short, finding the perfect cipher
string is impossible and must be a tradeoff. On the one hand
there are mandatory and optional ciphers defined in a few RFCs, on the other hand
there are clients and servers only implementing subsets of the specification.

Straight forward, we wanted strong ciphers, forward secrecy
\footnote{\url{http://nmav.gnutls.org/2011/12/price-to-pay-for-perfect-forward.html}}
and the most clients we could get while still having a cipher string that can be
used on older servers too (think OpenSSL 0.9.8). This cipher string is meant to be used
by copy and paste and needs to just work.

\begin{itemize}
\item TLS1.2 is preferred over TLSv1.0/SSLv3 (while still providing a useable cipher
      string for SSLv3).
\item AES256 and CAMELLIA256 count as strong ciphers at the moment; preferrably in
      GCM mode.\\
	  \todo{add a reference here please}
\item AES128 and CAMELLIA128 still count as strong enough ciphers at the moment
\item DHE or ECDHE for forward secrecy
\item RSA as this will fit most of todays setup
\item AES256-SHA as a last ressort (with this cipher at the end, even systems with
      very old versions of openssl like 0.9.8 will just work. Just forward secrecy
      will not be used. On systems that do not support elliptic curves, that cipher
      offers support for the Microsoft crypto libraries that only support ECDHE.
\end{itemize}

\todo{Adi: review "justification" when next section is written}
